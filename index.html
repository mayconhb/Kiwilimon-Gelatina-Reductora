<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receta de Gelatina Reductora - Kiwilimón Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,300;1,400&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'kiwi-green': '#85c440',
              'kiwi-dark-green': '#6da530',
              'kiwi-text': '#333333',
              'kiwi-gray': '#666666',
              'kiwi-light-gray': '#f2f2f2',
            },
            fontFamily: {
              serif: ['Merriweather', 'serif'],
              sans: ['Open Sans', 'sans-serif'],
            }
          }
        }
      }
    </script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.561.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="bg-[#f4f4f4] font-sans">
    <div id="app" class="min-h-screen bg-[#f4f4f4] max-w-md mx-auto shadow-2xl overflow-hidden pb-20">
        
        <!-- Header -->
        <header id="main-header" class="bg-kiwi-green text-white sticky top-0 z-50 shadow-md">
            <div class="flex items-center justify-between px-4 h-14">
                <div class="flex items-center gap-4">
                    <button class="p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                    </button>
                    <div class="text-2xl font-bold tracking-tight font-sans">kiwilimón</div>
                </div>
                <div class="flex items-center">
                    <div class="bg-white text-kiwi-green p-2 h-14 w-12 flex items-center justify-center border-b-4 border-kiwi-green shadow-sm z-10 relative top-[2px]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
                    </div>
                    <button class="p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </button>
                    <button class="p-3 relative">
                        <div class="bg-white rounded-full p-1 text-kiwi-green">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <span class="absolute top-2 right-1 bg-red-500 text-white text-[10px] font-bold px-1.5 rounded-full border border-kiwi-green">1</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Static Top Content (Hidden when quiz starts) -->
        <div id="static-top-content">
            <!-- Breadcrumbs -->
            <div class="bg-[#f4f4f4] px-4 py-2 text-xs text-gray-500 flex flex-wrap items-center gap-1 font-sans overflow-x-hidden whitespace-nowrap">
                <span>Inicio</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                <span>Recetas</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                <span>Recetas para Adelgazar</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                <span class="text-kiwi-green truncate max-w-[150px]">Gelatina Reductora</span>
            </div>

            <!-- Recipe Title -->
            <div class="px-4 py-6 bg-white">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800 uppercase font-sans mb-4">
                    Gelatina Reductora
                </h1>
                <div class="mb-4">
                    <div class="text-lg text-gray-700 leading-relaxed font-sans">
                        Receta utilizada por celebridades como Kelly Clarkson, Kim Kardashian y la influencer mexicana Gomita para bajar de 3 a 5 kg cada 7 días sin dieta, sin medicamentos y sin gimnasio. Esta receta se volvió viral en todo internet después de que Gomita revelara este secreto y sorprendiera a sus fans.
                    </div>
                </div>
                <div class="text-xs text-gray-400 italic">
                    Receta enviada por: <span class="text-kiwi-green font-bold">Dra. Patricia Fernandez</span>
                    <br />
                    Publicada: 16-12-2025
                </div>
            </div>

            <!-- Media Section -->
            <div class="relative w-full aspect-video bg-gray-200 group cursor-pointer overflow-hidden">
                <img src="https://picsum.photos/800/450?random=2" alt="Gelatina Reductora" class="w-full h-full object-cover">
                <div class="absolute inset-0 flex items-center justify-center bg-black/20 group-hover:bg-black/30 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="rgba(0,0,0,0.5)" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white opacity-90"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>
                </div>
                <div class="absolute top-4 left-4">
                    <div class="bg-kiwi-green text-white px-3 py-4 flex flex-col items-center justify-center text-xs font-bold leading-tight w-20 h-16 shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
                        <span class="text-[10px] text-center uppercase leading-none">Sube tu Foto</span>
                    </div>
                </div>
                <div class="absolute top-4 right-0">
                    <div class="bg-gray-500/80 text-white px-3 py-2 text-xl font-bold">1</div>
                </div>
            </div>
        </div>

        <!-- Rating Bar (Always visible) -->
        <div class="bg-white py-3 border-b border-gray-200 flex justify-center items-center gap-2 sticky top-0 z-40 shadow-sm">
            <span class="text-gray-500 font-bold">5</span>
            <div class="flex text-kiwi-green">
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
            </div>
            <div class="h-4 w-px bg-gray-300 mx-1"></div>
            <span class="text-gray-400 italic text-sm">3958 comentarios</span>
        </div>

        <!-- Ingredients / Quiz Section -->
        <div class="bg-white px-4 py-6 relative">
            <div class="border-b border-gray-100 pb-2 mb-6">
                <div class="flex justify-between items-end">
                    <h2 class="text-2xl font-serif italic text-gray-800">Ingredientes</h2>
                    <div class="flex items-center gap-4 text-gray-500 text-xs">
                        <div class="flex flex-col items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-1"><path d="M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z"/><path d="m14.5 12.5 2-2"/><path d="m11.5 9.5 2-2"/><path d="m8.5 6.5 2-2"/><path d="m17.5 15.5 2-2"/></svg>
                            <span>Medidas</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="font-bold text-xl leading-none mb-1 text-gray-700">4</div>
                            <span>Porciones</span>
                        </div>
                    </div>
                </div>
                
                <!-- Dynamic Progress Bar (Hidden initially) -->
                <div id="quiz-progress-container" class="hidden mt-3 flex items-center justify-between gap-3 animate-fade-in">
                    <span class="text-gray-500 font-sans text-sm font-medium whitespace-nowrap">Personalizando tu receta</span>
                    <div class="flex-1 h-3 bg-gray-100 rounded-full overflow-hidden">
                        <div id="quiz-progress-bar" class="h-full bg-kiwi-green transition-all duration-700 ease-out" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="relative min-h-[300px]">
                <!-- Static Ingredients Overlay -->
                <div id="static-ingredients-view">
                    <div class="filter blur-[2px] select-none opacity-80 pointer-events-none">
                        <div class="flex items-center gap-3 mb-4 py-2">
                            <div class="w-6 h-6 rounded-full border border-gray-400"></div>
                            <span class="text-gray-900 italic font-medium">Seleccionar todos los ingredientes</span>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">1 taza de yoghurt estilo griego Fage® Total 0%</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">90 gramos de mantequilla sin sal</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">1 cucharada de vinagre</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">1 cucharada de azúcar mascabado</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">1 cucharada de cayena</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">1/2 taza de agua purificada</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">2 sobres de grenetina natural</span></div>
                            <div class="flex items-center gap-3"><div class="w-6 h-6 rounded-full border border-gray-400 flex-shrink-0 bg-gray-100"></div><span class="text-gray-900 font-medium text-sm leading-tight flex-1">Jugo de 1 limón fresco</span></div>
                        </div>
                    </div>
                    <div class="absolute inset-0 z-10 flex items-center justify-center p-4">
                        <div class="bg-white rounded-xl shadow-2xl border-2 border-gray-100 p-6 max-w-sm w-full text-center transform transition-transform">
                            <p class="text-gray-700 text-sm font-sans mb-4 leading-relaxed">
                                <span class="font-bold text-gray-900">Atención:</span> Las cantidades de los ingredientes de esta receta deben personalizarse para cada tipo de cuerpo y rutina para un máximo efecto adelgazante.
                            </p>
                            <p class="text-gray-500 text-xs mb-5 font-medium">
                                Haz clic abajo y personalizaremos tu receta exclusiva.
                            </p>
                            <button id="start-quiz-btn" type="button" class="bg-kiwi-green hover:bg-kiwi-dark-green text-white font-bold py-3 px-4 rounded w-full flex items-center justify-center gap-2 transition-colors uppercase text-sm shadow-md">
                                PERSONALIZAR MI RECETA
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quiz Container (Where the quiz will be injected) -->
                <div id="quiz-container" class="hidden"></div>
            </div>
        </div>

        <!-- Preparation Section -->
        <div class="bg-white px-4 py-6 mt-4">
            <div class="flex flex-wrap justify-between items-center mb-6 border-b border-gray-100 pb-2">
                <h2 class="text-2xl font-serif italic text-gray-800">Preparación</h2>
                <div class="flex items-center gap-3 text-xs text-gray-500">
                    <div class="flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 10.59 0A4 4 0 0 1 18 13.87V21H6Z"/><line x1="6" x2="18" y1="17" y2="17"/></svg> 20 mins</div>
                    <span>|</span>
                    <div class="flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg> 5 mins</div>
                    <span>|</span>
                    <div class="flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="rotate-90"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg> Baja</div>
                </div>
            </div>

            <div class="bg-[#f2f2f2] rounded-lg py-6 px-4 flex flex-col items-center justify-center text-center text-gray-500 border border-gray-200">
                <div class="mb-2 text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                </div>
                <p class="text-sm font-medium leading-snug max-w-[280px]">
                    Personaliza tu receta en el botón de arriba para ver la preparación.
                </p>
            </div>
        </div>

        <!-- Comments Section -->
        <div class="bg-white px-4 py-6 mt-4">
            <div class="flex justify-between items-center mb-6 border-b border-gray-100 pb-2">
                <h2 class="text-2xl font-serif italic text-gray-800">Comentarios</h2>
                <div class="flex items-center gap-1 text-xs text-gray-500">
                    <span class="font-bold">5.0</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-kiwi-green fill-current"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                    <span>(3958)</span>
                </div>
            </div>

            <div id="comments-list" class="space-y-6">
                <!-- Comments injected via JS -->
            </div>

            <button id="load-more-comments" class="w-full py-3 mt-6 text-kiwi-green font-bold text-sm border border-kiwi-green rounded-lg hover:bg-green-50 transition-colors uppercase">
                Ver más comentarios
            </button>
        </div>

    </div>
    
    <script>
    (function() {
        console.log("App script starting...");

        // --- State Management ---
        const state = {
            step: 1,
            sliderValue: 50,
            selectedBenefits: [],
            visibleComments: 3,
            isQuizActive: false,
            totalSteps: 17
        };

        // --- Data ---
        const commentsData = [
            { id: 1, name: "Susana Pérez", initial: "S", color: "bg-green-500", time: "Hace 4 horas", content: "Sabe muy rica, nada que ver con otros remedios que saben feo. ¡Me encantó!", likes: 89 },
            { id: 2, name: "Claudia Rodríguez", initial: "C", color: "bg-purple-500", time: "Hace 5 horas", content: "Me siento mucho más desinflamada del abdomen. Gracias Dra. Patricia por compartir.", likes: 210 },
            { id: 3, name: "Patsy López", initial: "P", color: "bg-red-500", time: "Hace 1 dia", content: "¿Se puede tomar en la noche? A mí me funcionó de maravilla en ayunas.", likes: 56 },
            { id: 4, name: "Lupita Martinez", initial: "L", color: "bg-orange-500", time: "Hace 1 día", content: "100% recomendada. Fácil de preparar y los ingredientes son sencillos.", likes: 112 },
            { id: 5, name: "Mariana Costa", initial: "M", color: "bg-blue-500", time: "Hace 1 día", content: "Tenía miedo de que fuera difícil de seguir con el trabajo, pero me llevo la gelatina en un tupper y listo.", likes: 45 },
            { id: 6, name: "Fernanda G.", initial: "F", color: "bg-pink-500", time: "Hace 2 días", content: "Yo pensé que era puro cuento, pero mi ropa ya me queda más floja. ¡Gracias por compartir!", likes: 78 },
            { id: 7, name: "Roberto Méndez", initial: "R", color: "bg-teal-500", time: "Hace 2 días", content: "A mi esposa le encantó el sabor y ya se nota el cambio. La preparamos juntos.", likes: 33 },
            { id: 8, name: "Ana S.", initial: "A", color: "bg-indigo-500", time: "Hace 2 días", content: "¿Alguien sabe si los niños pueden probarla? Se ve deliciosa.", likes: 12 },
            { id: 9, name: "Carmen Ruiz", initial: "C", color: "bg-indigo-600", time: "Hace 3 días", content: "Excelente receta, muy fácil de seguir y efectiva.", likes: 15 },
        ];

        // --- Icons ---
        const icons = {
            chevronRight: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-300 group-hover:text-kiwi-green"><path d="m9 18 6-6-6-6"/></svg>`,
            arrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-kiwi-green"><polyline points="20 6 9 17 4 12"/></svg>`,
            checkWhite: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><polyline points="20 6 9 17 4 12"/></svg>`,
            camera: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-2 opacity-50"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>`,
            star: `<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
            alertTriangle: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>`,
            thumbsUp: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>`,
            messageSquare: `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>`,
            loader: `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-kiwi-green animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>`,
            playCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white fill-kiwi-green group-hover:scale-110 transition-transform"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>`
        };

        let dom = {};

        // --- Core Functions (Hoisted) ---

        // We assign these to window so HTML inline onclick handlers can find them.
        window.startQuiz = function() {
            console.log("startQuiz called");
            state.isQuizActive = true;
            if(dom.staticTop) dom.staticTop.style.display = 'none';
            if(dom.staticIngredients) dom.staticIngredients.style.display = 'none';
            if(dom.quizContainer) {
                dom.quizContainer.classList.remove('hidden');
                dom.quizContainer.style.display = 'block'; // Force display
            }
            if(dom.progressContainer) {
                dom.progressContainer.classList.remove('hidden');
                dom.progressContainer.style.display = 'flex'; // Force display
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
            renderStep();
        };

        window.nextStep = function() {
            if (state.step < state.totalSteps) {
                state.step++;
                updateProgress();
                renderStep();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        window.toggleBenefit = function(btn, option) {
            if (state.selectedBenefits.includes(option)) {
                state.selectedBenefits = state.selectedBenefits.filter(b => b !== option);
            } else {
                state.selectedBenefits.push(option);
            }
            renderStep(); 
        };
        
        // --- Rendering Logic ---

        function updateProgress() {
            if (!dom.progressBar) return;
            const ratio = state.step / state.totalSteps;
            const progressPercent = Math.min(100, Math.round(10 + 90 * Math.pow(ratio, 0.8)));
            dom.progressBar.style.width = `${progressPercent}%`;
        }

        function renderStep() {
            const container = dom.quizContainer;
            if (!container) return;
            
            container.innerHTML = ''; 

            if (state.step === 10) state.sliderValue = 70;
            if (state.step === 11) state.sliderValue = 165;
            if (state.step === 12) state.sliderValue = 60;

            let content = '';

            switch(state.step) {
                case 1:
                    content = `
                        <h3 class="text-xl font-bold text-gray-800 mb-2">¿Cuántos kilos deseas perder?</h3>
                        <p class="text-sm text-gray-500 mb-6">Con base en tu respuesta, veremos si estás apta para eliminar grasa de forma acelerada.</p>
                        ${renderQuizButton('Hasta 5 kg')}
                        ${renderQuizButton('De 6 a 10 kg')}
                        ${renderQuizButton('De 11 a 15 kg')}
                        ${renderQuizButton('De 16 a 20 kg')}
                        ${renderQuizButton('Más de 20 kg')}
                    `;
                    break;
                case 2:
                    content = `
                        <h3 class="text-xl font-bold text-gray-800 mb-6">¿Cómo clasificarías tu cuerpo hoy?</h3>
                        ${renderQuizButton('Regular')}
                        ${renderQuizButton('Flácido')}
                        ${renderQuizButton('Sobrepeso')}
                        ${renderQuizButton('Obeso')}
                    `;
                    break;
                case 3:
                    content = `
                        <h3 class="text-xl font-bold text-gray-800 mb-6">¿En qué zona de tu cuerpo te gustaría reducir más grasa?</h3>
                        ${renderQuizButton('Región de las Caderas')}
                        ${renderQuizButton('Región de los Muslos')}
                        ${renderQuizButton('Región del Abdomen (barriga)')}
                        ${renderQuizButton('Región de los Glúteos')}
                        ${renderQuizButton('Región de los Brazos')}
                    `;
                    break;
                case 4:
                    content = `
                        <h3 class="text-xl font-bold text-gray-800 mb-6">¿Realmente estás feliz con tu apariencia?</h3>
                        ${renderQuizButton('No, porque me siento con sobrepeso')}
                        ${renderQuizButton('Sí, pero sé que puedo mejorar mi salud')}
                        ${renderQuizButton('No, me gustaría bajar de peso para mejorar mi bienestar')}
                    `;
                    break;
                case 5:
                    content = `
                        <h3 class="text-xl font-bold text-gray-800 mb-6">¿Qué es lo que más te impide bajar de peso?</h3>
                        ${renderQuizButton('Falta de tiempo – Rutina agitada')}
                        ${renderQuizButton('Autocontrol – Dificultad para resistir las tentaciones')}
                        ${renderQuizButton('Finanzas – Considerar que lo saludable es caro')}
                    `;
                    break;
                case 6:
                    content = `
                        <h3 class="text-xl font-bold text-gray-800 mb-6">¿Cómo afecta tu peso a tu vida?</h3>
                        ${renderQuizButton('Evito tomarme fotos porque me da vergüenza')}
                        ${renderQuizButton('Mi pareja ya no me mira con deseo como antes')}
                        ${renderQuizButton('Evito reuniones sociales porque no me siento bien')}
                        ${renderQuizButton('Ninguna de las opciones')}
                    `;
                    break;
                case 7:
                    content = renderBenefitsStep();
                    break;
                case 8:
                    content = `
                        <div class="py-2">
                            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center leading-tight">
                                ¡Conoce la Receta Personalizada de la Gelatina Reductora que está ayudando a celebridades y a miles de mujeres comunes a adelgazar sin gastar una fortuna en farmacia!
                            </h3>
                            <p class="text-gray-600 text-sm text-center mb-4">
                                Esta receta es <span class="font-bold">10 veces más potente</span> que el Mounjaro y el Ozempic juntos...
                            </p>
                            <p class="text-gray-600 text-sm text-center mb-6">
                                Controla tu apetito, acelera tu metabolismo y te ayuda a <span class="underline text-blue-600 font-medium">eliminar grasa de forma rápida y eficaz</span>.
                            </p>
                            ${renderContinueButton()}
                            <div class="my-8 border-t border-gray-200"></div>
                            <h3 class="text-xl font-bold text-gray-800 mb-4 text-center uppercase">
                                ¿CÓMO FUNCIONA LA RECETA DE LA GELATINA REDUCTORA?
                            </h3>
                            <div class="w-full aspect-square bg-gray-100 rounded-lg flex items-center justify-center mb-6 border-2 border-dashed border-gray-300">
                                <div class="text-center text-gray-400 p-4">
                                    ${icons.camera}
                                    <span class="font-bold text-sm">Espacio para Imagen del Ciclo</span>
                                </div>
                            </div>
                            <p class="text-gray-700 text-sm text-center mb-4 leading-relaxed">
                                Los componentes de la Receta Personalizada de la Gelatina Reductora siguen actuando mientras duermes, <span class="font-bold">activando tus células quemadoras de grasa</span> y acelerando la producción natural de GLP-1.
                            </p>
                            <p class="text-gray-700 text-sm text-center mb-6 leading-relaxed">
                                Esto mantiene tu metabolismo quemando grasa <span class="font-bold">hasta 10 veces más rápido</span> durante el sueño.
                            </p>
                            ${renderContinueButton()}
                        </div>
                    `;
                    break;
                case 9:
                    content = renderTestimonialsStep();
                    break;
                case 10:
                    content = renderRangeStep("¿Cuál es tu peso actual?", "¡Comencemos! Esto nos ayuda a personalizar tu receta.", 50, 150, "kg", "50 kg", "150 kg");
                    break;
                case 11:
                    content = renderRangeStep("¿Cuál es tu estatura?", "Calcularemos la dosis exacta de los ingredientes para tu cuerpo.", 140, 200, "cm", "140 cm", "200 cm");
                    break;
                case 12:
                    content = renderRangeStep("¿Cuál es tu peso objetivo?", "¡Casi listo! Esto nos ayuda a definir tu meta.", 40, 120, "kg", "40 kg", "120 kg");
                    break;
                case 13:
                    content = `
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">¿Cuántos vasos de agua bebes al día?</h3>
                            <p class="text-sm text-gray-500 mb-6">Tu nivel de hidratación también influye en tu pérdida de peso.</p>
                            ${renderQuizButton('Solo bebo café o té')}
                            ${renderQuizButton('1–2 vasos al día')}
                            ${renderQuizButton('2–6 vasos al día')}
                            ${renderQuizButton('Más de 6 vasos')}
                        </div>
                    `;
                    break;
                case 14:
                    content = renderLoadingStep();
                    break;
                case 15:
                    content = `
                        <div class="py-2">
                            <div class="flex items-center gap-2 text-red-600 font-bold text-xl mb-4">
                                ${icons.alertTriangle}
                                ¡ATENCIÓN!
                            </div>
                            <p class="text-gray-800 mb-6 leading-relaxed">
                                Según tus respuestas, tu cuerpo está en modo <span class="font-bold bg-yellow-100 px-1">ACUMULACIÓN DE GRASA</span>. Si no actúas HOY, esta situación tiende a <span class="font-bold text-red-600">EMPEORAR</span>.
                            </p>
                            
                            <div class="mb-8 flex flex-col items-center w-full">
                                <div class="text-gray-600 text-lg mb-1 font-sans">Tu IMC:</div>
                                <div class="text-5xl font-bold text-[#f97316] tracking-tighter">25.7</div>
                                
                                <div class="w-full relative mt-10 px-1">
                                    <div class="absolute bottom-full mb-1 flex flex-col items-center transform -translate-x-1/2 transition-all duration-1000" style="left: 55%">
                                        <span class="text-[#f97316] text-sm font-bold mb-0 leading-none">Tú hoy</span>
                                        <div class="w-0 h-0 border-l-[6px] border-l-transparent border-r-[6px] border-r-transparent border-t-[8px] border-t-[#f97316] mt-1"></div>
                                    </div>

                                    <div class="flex w-full h-8 rounded-lg overflow-hidden text-[10px] md:text-xs font-bold text-white text-center leading-8 shadow-inner">
                                        <div class="bg-[#4285F4] flex-1 border-r border-white/20 flex items-center justify-center">Bajo peso</div>
                                        <div class="bg-[#34A853] flex-1 border-r border-white/20 flex items-center justify-center">Normal</div>
                                        <div class="bg-[#f97316] flex-1 border-r border-white/20 flex items-center justify-center">Sobrepeso</div>
                                        <div class="bg-[#EA4335] flex-1 flex items-center justify-center">Obesidad</div>
                                    </div>
                                </div>
                            </div>

                            <h4 class="font-bold text-gray-900 mb-2">¡Tus células quemagrasas pueden estar dormidas y saboteando tu metabolismo sin que te des cuenta!</h4>
                            <p class="text-sm text-gray-600 mb-4 leading-relaxed">
                            Incluso si estás en un peso normal, tu cuerpo podría estar desactivando las células quemagrasas del intestino, lo que ralentiza tu metabolismo.
                            </p>

                            <div class="space-y-2 mb-6">
                                <div class="flex gap-2 items-start text-sm text-gray-700">
                                <div class="min-w-1.5 w-1.5 h-1.5 bg-red-500 rounded-full mt-1.5"></div>
                                <p>Metabolismo lento y dificultad para adelgazar aunque comas poco</p>
                                </div>
                                <div class="flex gap-2 items-start text-sm text-gray-700">
                                <div class="min-w-1.5 w-1.5 h-1.5 bg-red-500 rounded-full mt-1.5"></div>
                                <p>Cansancio constante y sensación de hinchazón</p>
                                </div>
                                <div class="flex gap-2 items-start text-sm text-gray-700">
                                <div class="min-w-1.5 w-1.5 h-1.5 bg-red-500 rounded-full mt-1.5"></div>
                                <p>Acumulación de grasa en zonas específicas del cuerpo, especialmente en el abdomen</p>
                                </div>
                            </div>

                            <div class="bg-green-50 border border-green-200 p-4 rounded-lg mb-4">
                                <p class="text-sm text-gray-800 font-medium leading-relaxed">
                                Con la <span class="text-kiwi-green font-bold">Receta Personalizada de la Gelatina Reductora</span>, tu cuerpo acelera la quema de grasa de forma natural. La combinación ideal de ingredientes puede reactivar las células quemagrasas.
                                </p>
                            </div>

                            <p class="text-center text-gray-600 text-sm font-medium mb-2">Mira la transformación de Rosana.</p>
                            ${renderContinueButton()}
                        </div>
                    `;
                    break;
                case 16:
                    content = `
                        <div class="py-2">
                        <h3 class="text-xl font-bold text-gray-800 mb-8 text-center leading-tight">¿Estás lista para transformar tu cuerpo y tu salud?</h3>
                        
                        <div class="flex items-center justify-center gap-1 mb-8">
                            <div class="bg-red-50 border border-red-200 p-3 rounded-xl text-center flex-1 min-w-0 shadow-sm h-full flex flex-col justify-between">
                                <div class="text-red-500 font-bold text-[10px] mb-3 uppercase tracking-wide leading-tight min-h-[2.5em] flex items-center justify-center">SIN LA RECETA PERSONALIZADA</div>
                                <div class="space-y-2 text-[10px] text-gray-600 font-medium">
                                <div class="flex justify-between items-center border-b border-red-100 pb-1">
                                    <span>Metabolismo:</span> <span class="font-bold text-red-600">Lento</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-red-100 pb-1">
                                    <span>Estrés:</span> <span class="font-bold text-red-600">Alto</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-red-100 pb-1">
                                    <span>Energía:</span> <span class="font-bold text-red-600">Bajo</span>
                                </div>
                                <div class="flex justify-between items-center pt-0.5">
                                    <span>Riesgo:</span> <span class="font-bold text-red-600">Altísimos</span>
                                </div>
                                </div>
                            </div>
                            
                            <div class="text-gray-400 shrink-0 z-10 -mx-1">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                            </div>
                            
                            <div class="bg-white border-2 border-[#8CC63F] p-3 rounded-xl text-center shadow-lg flex-1 min-w-0 transform scale-105 z-0 h-full flex flex-col justify-between">
                                <div class="text-[#8CC63F] font-bold text-[10px] mb-3 uppercase tracking-wide leading-tight min-h-[2.5em] flex items-center justify-center">CON LA RECETA PERSONALIZADA</div>
                                <div class="space-y-2 text-[10px] text-gray-600 font-medium">
                                <div class="flex justify-between items-center border-b border-gray-100 pb-1">
                                    <span>Metabolismo:</span> <span class="font-bold text-[#8CC63F]">Acelerado</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-100 pb-1">
                                    <span>Estrés:</span> <span class="font-bold text-[#8CC63F]">Bajo</span>
                                </div>
                                <div class="flex justify-between items-center border-b border-gray-100 pb-1">
                                    <span>Energía:</span> <span class="font-bold text-[#8CC63F]">Fuerte</span>
                                </div>
                                <div class="flex justify-between items-center pt-0.5">
                                    <span>Riesgo:</span> <span class="font-bold text-[#8CC63F]">Muy bajo</span>
                                </div>
                                </div>
                            </div>
                        </div>

                        <p class="text-center text-gray-600 mb-4 text-sm font-medium">
                            Haz clic en el botón de abajo para recibir tu Receta Personalizada
                        </p>

                        <button onclick="nextStep()" class="w-full bg-kiwi-green text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-kiwi-dark-green transition-all mt-4 flex items-center justify-center gap-2 uppercase text-sm">
                            ACCEDER A LA RECETA PERSONALIZADA ${icons.arrowRight}
                        </button>
                        </div>
                    `;
                    break;
                case 17:
                    content = `
                        <div class="py-4 text-center">
                        <h3 class="text-lg font-bold text-gray-800 mb-4 uppercase leading-snug">
                            MIRA ESTE VIDEO DONDE LA DRA. PATRICIA FERNANDEZ EXPLICA CÓMO USAR TU RECETA
                        </h3>
                        <div class="w-full aspect-video bg-black rounded-lg flex items-center justify-center relative overflow-hidden shadow-lg group cursor-pointer">
                            <img src="https://picsum.photos/800/450?random=8" class="w-full h-full object-cover opacity-60" alt="Video thumbnail" />
                            <div class="absolute inset-0 flex items-center justify-center">
                                ${icons.playCircle}
                            </div>
                        </div>
                        <div class="mt-6 bg-yellow-50 border border-yellow-200 p-4 rounded-lg text-sm text-yellow-800">
                            <p class="font-bold">¡Importante!</p>
                            <p>Ve el video completo para liberar tu receta personalizada.</p>
                        </div>
                        </div>
                    `;
                    break;
            }

            container.innerHTML = content;

            if (state.step >= 10 && state.step <= 12) {
                setupRangeSlider();
            }
            if (state.step === 14) {
                setupLoadingLogic();
            }
        }

        // --- Template Helpers ---

        function renderQuizButton(text) {
            return `
                <button onclick="nextStep()" class="w-full bg-white border border-gray-300 text-gray-700 font-medium py-3 px-4 rounded-lg shadow-sm hover:bg-gray-50 hover:border-kiwi-green hover:text-kiwi-green transition-all mb-3 text-left flex items-center justify-between group">
                    ${text}
                    ${icons.chevronRight}
                </button>
            `;
        }

        function renderContinueButton() {
            return `
                <button onclick="nextStep()" class="w-full bg-kiwi-green text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-kiwi-dark-green transition-all mt-4 flex items-center justify-center gap-2 uppercase">
                    Continuar ${icons.arrowRight}
                </button>
            `;
        }

        function renderBenefitsStep() {
            const options = [
                "Bajar de peso sin esfuerzo y sin efecto rebote",
                "Dormir más profundamente",
                "Tener más energía y disposición durante el día",
                "Aumentar la autoestima y la confianza",
                "Reducir el estrés y la ansiedad"
            ];

            const buttonsHtml = options.map(option => {
                const isSelected = state.selectedBenefits.includes(option);
                return `
                    <button onclick="toggleBenefit(this, '${option}')" class="w-full bg-white border ${isSelected ? 'border-kiwi-green ring-1 ring-kiwi-green' : 'border-gray-300'} text-gray-700 font-medium py-3 px-4 rounded-lg shadow-sm hover:bg-gray-50 transition-all text-left flex items-center gap-3 group">
                        <div class="w-5 h-5 rounded border ${isSelected ? 'bg-kiwi-green border-kiwi-green' : 'border-gray-300'} flex items-center justify-center transition-colors shrink-0">
                            ${isSelected ? icons.checkWhite : ''}
                        </div>
                        <span class="${isSelected ? 'text-kiwi-green font-bold' : ''}">${option}</span>
                    </button>
                `;
            }).join('');

            return `
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">¿Cuáles de estos beneficios te gustaría tener?</h3>
                    <p class="text-sm text-gray-500 mb-6">Personalizaremos tu receta para maximizar los resultados.</p>
                    <div class="space-y-3 mb-6" id="benefits-container">
                        ${buttonsHtml}
                    </div>
                    ${renderContinueButton()}
                </div>
            `;
        }

        function renderTestimonialsStep() {
            const stars = `<div class="flex text-yellow-400 gap-0.5">${icons.star.repeat(5)}</div>`;
            return `
                <div class="py-2">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center leading-tight">
                        Resultados de quienes ya están usando la Receta Personalizada de la Gelatina Reductora
                    </h3>
                    <!-- Testimonials HTML omitted for brevity but logic is same as before -->
                     <!-- Gomita -->
                    <div class="mb-6">
                        <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg flex items-center justify-center mb-4 text-gray-400 border-2 border-dashed border-gray-300">
                        <span class="font-bold text-sm">Foto Antes / Después (Gomita)</span>
                        </div>
                        <p class="text-gray-700 italic mb-3 text-sm leading-relaxed">
                        "Ya había intentado de todo para adelgazar, pero nada funcionaba realmente. Después de empezar a usar la receta de la Gelatina Reductora en mi día a día, perdí 8 kilos en solo 17 días — sin cambiar nada en mi alimentación. Ahora me siento más ligera, más bonita y con una confianza que no sentía desde hacía años."
                        </p>
                        <div class="font-bold text-gray-900 text-sm">— Gomita / Influenciadora Mexicana</div>
                        <div class="flex items-center gap-2 mt-1">${stars}</div>
                    </div>
                    ${renderContinueButton()}
                    <div class="my-8 border-t border-gray-200"></div>
                     <!-- Fernanda -->
                    <div class="mb-8">
                        <div class="w-full aspect-[4/3] bg-gray-200 rounded-lg flex items-center justify-center mb-4 text-gray-400 border-2 border-dashed border-gray-300">
                        <span class="font-bold text-sm">Foto Antes / Después (Fernanda)</span>
                        </div>
                        <p class="text-gray-700 italic mb-3 text-sm leading-relaxed">
                        "Después de mi embarazo, mi abdomen no volvía a la normalidad y me sentía muy frustrada. Probé esta receta sin mucha fe, pero los resultados fueron increíbles. En 3 semanas mi vientre está plano y he bajado 9 kilos. ¡Por fin volví a usar mi ropa de antes!"
                        </p>
                        <div class="font-bold text-gray-900 text-sm">— Fernanda Rodríguez — Ciudad de México</div>
                        <div class="flex items-center gap-2 mt-1">${stars}</div>
                    </div>
                    ${renderContinueButton()}
                </div>
            `;
        }

        function renderRangeStep(title, note, min, max, unit, labelStart, labelEnd) {
            const percentage = ((state.sliderValue - min) / (max - min)) * 100;
            const gradient = `linear-gradient(to right, #85c440 0%, #85c440 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;

            return `
                <div class="py-2">
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${title}</h3>
                    ${note ? `<p class="text-sm text-gray-500 mb-6">${note}</p>` : ''}
                    
                    <div class="flex justify-center mb-8">
                        <div class="text-5xl font-bold text-kiwi-green">
                            <span id="slider-display">${state.sliderValue}</span> <span class="text-xl text-gray-400 font-normal">${unit}</span>
                        </div>
                    </div>

                    <div class="relative w-full flex items-center">
                        <input 
                            type="range" 
                            id="range-input"
                            class="w-full h-12 appearance-none bg-transparent cursor-pointer focus:outline-none touch-none accent-kiwi-green"
                            min="${min}" 
                            max="${max}" 
                            value="${state.sliderValue}" 
                            style="background-image: ${gradient}; background-size: 100% 8px; background-position: center; background-repeat: no-repeat;"
                        />
                    </div>
                    
                    <div class="flex justify-between text-xs text-gray-400 mt-2 font-bold uppercase">
                        <span>${labelStart}</span>
                        <span>${labelEnd}</span>
                    </div>

                    <div class="mt-8 flex items-center gap-2 text-sm text-gray-600 bg-gray-50 p-3 rounded border border-gray-100">
                        ${icons.check}
                        Ajustaremos la dosis ideal para tu cuerpo.
                    </div>

                    ${renderContinueButton()}
                </div>
            `;
        }

        function setupRangeSlider() {
            const input = document.getElementById('range-input');
            const display = document.getElementById('slider-display');
            if (input && display) {
                input.addEventListener('input', (e) => {
                    const val = Number(e.target.value);
                    state.sliderValue = val;
                    display.textContent = val;
                    const min = Number(input.min);
                    const max = Number(input.max);
                    const percentage = ((val - min) / (max - min)) * 100;
                    input.style.backgroundImage = `linear-gradient(to right, #85c440 0%, #85c440 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
                });
            }
        }

        function renderLoadingStep() {
            return `
                <div class="flex flex-col items-center justify-center py-10 px-4">
                    <div class="relative mb-8">
                        ${icons.loader}
                        <div id="loading-percent" class="absolute inset-0 flex items-center justify-center font-bold text-xs text-kiwi-green">
                            0%
                        </div>
                    </div>
                    
                    <h3 id="loading-message" class="text-xl font-bold text-gray-800 mb-2 text-center animate-pulse">
                        Analizando sus respuestas...
                    </h3>
                    <p class="text-gray-500 text-sm text-center">
                        Por favor espere un momento...
                    </p>

                    <div class="w-full bg-gray-200 rounded-full h-2.5 mt-8">
                        <div 
                            id="loading-bar-fill"
                            class="bg-kiwi-green h-2.5 rounded-full transition-all duration-300 ease-out" 
                            style="width: 0%"
                        ></div>
                    </div>
                </div>
            `;
        }

        function setupLoadingLogic() {
            let progress = 0;
            let msgIndex = 0;
            const messages = [
                "Analizando sus respuestas...",
                "Calculando su Índice de Masa Corporal...",
                "Verificando su tipo metabólico...",
                "Generando su plan personalizado..."
            ];

            const percentEl = document.getElementById('loading-percent');
            const msgEl = document.getElementById('loading-message');
            const fillEl = document.getElementById('loading-bar-fill');

            const progressInterval = setInterval(() => {
                if (progress >= 100) {
                    progress = 100;
                } else {
                    progress++;
                }
                if(percentEl) percentEl.textContent = `${progress}%`;
                if(fillEl) fillEl.style.width = `${progress}%`;
            }, 35);

            const msgInterval = setInterval(() => {
                msgIndex = (msgIndex + 1) % messages.length;
                if(msgEl) msgEl.textContent = messages[msgIndex];
            }, 900);

            setTimeout(() => {
                clearInterval(progressInterval);
                clearInterval(msgInterval);
                nextStep();
            }, 4000);
        }

        // --- Comments Logic ---

        function renderComments() {
            if (!dom.commentsList) return;
            
            dom.commentsList.innerHTML = commentsData.slice(0, state.visibleComments).map(c => `
                <div class="flex gap-4">
                    <div class="w-10 h-10 rounded-full ${c.color} flex items-center justify-center text-white font-bold shrink-0 text-sm">
                        ${c.initial}
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-1">
                            <span class="font-bold text-gray-900 text-sm">${c.name}</span>
                            <span class="text-xs text-gray-400">${c.time}</span>
                        </div>
                        <p class="text-gray-700 text-sm leading-relaxed mb-2">
                            ${c.content}
                        </p>
                        <div class="flex items-center gap-4 text-xs text-gray-400 font-medium">
                            <button class="flex items-center gap-1 hover:text-kiwi-green transition-colors">
                                ${icons.thumbsUp}
                                <span>Útil (${c.likes})</span>
                            </button>
                            <button class="flex items-center gap-1 hover:text-kiwi-green transition-colors">
                                ${icons.messageSquare}
                                <span>Responder</span>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            if (state.visibleComments >= commentsData.length && dom.loadMoreBtn) {
                dom.loadMoreBtn.style.display = 'none';
            }
        }

        window.loadMoreComments = function() {
            state.visibleComments = Math.min(state.visibleComments + 3, commentsData.length);
            renderComments();
        };

        // --- Initialization ---

        function init() {
            try {
                dom = {
                    staticTop: document.getElementById('static-top-content'),
                    staticIngredients: document.getElementById('static-ingredients-view'),
                    startQuizBtn: document.getElementById('start-quiz-btn'),
                    quizContainer: document.getElementById('quiz-container'),
                    progressContainer: document.getElementById('quiz-progress-container'),
                    progressBar: document.getElementById('quiz-progress-bar'),
                    commentsList: document.getElementById('comments-list'),
                    loadMoreBtn: document.getElementById('load-more-comments')
                };

                // Attach Listeners
                if (dom.startQuizBtn) {
                    dom.startQuizBtn.addEventListener('click', window.startQuiz);
                    console.log("Attached start quiz listener");
                }
                
                if (dom.loadMoreBtn) {
                    dom.loadMoreBtn.addEventListener('click', window.loadMoreComments);
                }

                // Initial Render
                if (dom.commentsList) {
                    renderComments();
                    console.log("Rendered comments");
                }
            } catch (e) {
                console.error("Init failed:", e);
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

    })();
    </script>
</body>
</html>